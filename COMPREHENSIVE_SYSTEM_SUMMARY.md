# ุณุณุชู ุฌุงูุน ุตุฑุงู ฺูุฏ ุณุทุญ (Multi-Tenant Hierarchical Exchange System)

## โ ูฺฺฏโูุง ูพุงุฏูโุณุงุฒ ุดุฏู

### ๐๏ธ ูุนูุงุฑ ฺูุฏ ุณุทุญ (Multi-Tenant Hierarchy)

#### ุณุทูุญ ฺฉุงุฑุจุฑ:
1. **ุณููพุฑ ุงุฏูู (ูุงูฺฉ ุณุณุชู)**:
   - ูุฏุฑุช ฺฉู ูพูุชูุฑู
   - ุงุฌุงุฏ/ุญุฐู ุตุฑุงูโูุง (Tenants)
   - ุชูุธู ฺฉุงุฑูุฒุฏูุง ุณุณุชู
   - ุฏุณุชุฑุณ ุจู ุชูุงู ฺฏุฒุงุฑุดุงุช ูุงู

2. **ุตุฑุงูโูุง (Tenants)**:
   - ูุฏุฑุช ูุณุชูู ูุฑ ุตุฑุงู
   - ุงุฌุงุฏ ุดุนุจูโูุง ูุฎุชูู (Sub-tenants)
   - ุชุนู ูุฑุฎ ุงุฑุฒ ุงุฎุชุตุงุต
   - ูุฏุฑุช ูุดุชุฑุงู ุฎูุฏ

3. **ุดุนุจูโูุง (Sub-tenants)**:
   - ุงูุฌุงู ูุนุงููุงุช ูุญู
   - ฺฏุฒุงุฑุดโุฏู ุจู ุตุฑุงู ูุงุฏุฑ
   - ูุฏุฑุช ุญูุงููโูุง ุจู ุดุนุจูโุง

4. **ูุดุชุฑุงู ููุง (End Users)**:
   - ุงูุฌุงู ูุนุงููุงุช ุงุฑุฒ
   - ูุฏุฑุช ุญุณุงุจโูุง ฺูุฏ ุงุฑุฒ
   - ุฏุฑุฎูุงุณุช ุญูุงููโูุง ุจุงูฺฉ

### ๐ฐ ุณุณุชู ูพุฑุฏุงุฎุช ฺูุฏุญุณุงุจู

#### ูุฏู Payment:
- **ูพุฑุฏุงุฎุชโูุง ฺูุฏุญุณุงุจู**: ุงูฺฉุงู ุชูุณู ูพุฑุฏุงุฎุช ุจู ฺูุฏ ุญุณุงุจ ูุฎุชูู
- **ุขูพููุฏ ุฑุณุฏ**: ุซุจุช ุฎูุฏฺฉุงุฑ ุฑุณุฏูุง ูพุฑุฏุงุฎุช
- **ุชุทุจู ููุดููุฏ**: ุชุทุจู ูพุฑุฏุงุฎุชโูุง ุจุง ูุนุงููุงุช
- **ูุถุนุชโูุง ูพุฑุฏุงุฎุช**: ุฏุฑ ุงูุชุธุงุฑุ ุชุฃุฏ ุดุฏูุ ุฑุฏ ุดุฏูุ ูุบู ุดุฏู
- **ุฑูุดโูุง ูพุฑุฏุงุฎุช**: ุงูุชูุงู ุจุงูฺฉุ ููุฏุ ฺฉุงุฑุชุ ฺฉู ูพูู ุฏุฌุชุงูุ ุงุฑุฒ ุฏุฌุชุงู

#### ูฺฺฏโูุง ฺฉูุฏ:
```javascript
// ูุญุงุณุจู ูุจูุบ ุจุงูโูุงูุฏู
function calculateRemaining() {
  const total = transaction.amount;
  const paid = payments.reduce((sum, p) => sum + p.amount, 0);
  return total - paid;
}
```

### ๐ฆ ูุฏุฑุช ุจุฏูโูุง

#### ูุฏู Debt:
- **ูพฺฏุฑ ูุถุนุช ุจุฏู**: ูุฏุฑุช ฺฉุงูู ุจุฏูโูุง ูุดุชุฑุงู
- **ูุญุงุณุจู ุณูุฏ ู ุฌุฑูู**: ูุญุงุณุจู ุฎูุฏฺฉุงุฑ ุณูุฏ ุชุฃุฎุฑ
- **ุงุนูุงู ุฎูุฏฺฉุงุฑ**: ุงุฑุณุงู ุงุนูุงู ุจุฑุง ูพุฑุฏุงุฎุชโูุง ูุนูู
- **ุงูุฏุงูุงุช ูุตูู**: ูุฏุฑุช ูุฑุขูุฏ ูุตูู ุจุฏูโูุง

#### ูฺฺฏโูุง ฺฉูุฏ:
```javascript
// ูุญุงุณุจู ุฑูุฒูุง ูุนูู
function calculateDaysOverdue(dueDate) {
  const now = new Date();
  const due = new Date(dueDate);
  const diffTime = now - due;
  return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
}
```

### ๐ณ ุญุณุงุจโูุง ูฺฏูุฏุงุฑ ุงุฑุฒ

#### ูุฏู ExchangeAccount:
- **ุนููฺฉุฑุฏ ูุดุงุจู ุญุณุงุจ ุจุงูฺฉ**: ูฺฏูุฏุงุฑ ุงุฑุฒูุง ูุฎุชูู
- **ุจุฑุฏุงุดุช ุฌุฒุฆ ุง ฺฉู**: ุงูฺฉุงู ุจุฑุฏุงุดุช ุจุฎุด ุงุฒ ููุฌูุฏ
- **ุณูุฏุฏู**: ูุญุงุณุจู ุณูุฏ ุจุฑ ุงุณุงุณ ูุฑุงุฑุฏุงุฏ
- **ูุญุฏูุฏุชโูุง ุจุฑุฏุงุดุช**: ฺฉูุชุฑู ุฑูุฒุงูู ู ูุงูุงูู

#### ูฺฺฏโูุง ฺฉูุฏ:
```javascript
// ุจุฑุฑุณ ุงูฺฉุงู ุจุฑุฏุงุดุช
function canWithdraw(amount) {
  if (this.availableBalance < amount) return false;
  if (this.limits.dailyWithdrawal > 0 && 
      this.usage.dailyWithdrawalUsed + amount > this.limits.dailyWithdrawal) {
    return false;
  }
  return true;
}
```

### ๐ ูพุดุชุจุงู ุงุฒ ฺูุฏ ุดุนุจู

#### ูุฏู InterBranchTransfer:
- **ูุฏุฑุช ูุชูุฑฺฉุฒ ุดุนุจูโูุง**: ฺฉูุชุฑู ฺฉุงูู ุงุฒ ูุฑฺฉุฒ
- **ฺฏุฒุงุฑุดโุฏู ูุณุชูู**: ฺฏุฒุงุฑุดโูุง ุฌุฏุงฺฏุงูู ูุฑ ุดุนุจู
- **ุงูุชูุงู ูุฌู ุจู ุดุนุจูโุง**: ุญูุงููโูุง ุงูู ุจู ุดุนุจูโูุง
- **ุชุฃุฏ ุฏู ูุฑุญููโุง**: ุงููุช ุจุงูุง ุจุง ุฑูุฒ ุชุฃุฏ

#### ูฺฺฏโูุง ฺฉูุฏ:
```javascript
// ุชููุฏ ฺฉุฏ ุชุฃุฏ
function generateVerificationCode() {
  return Math.floor(100000 + Math.random() * 900000).toString();
}
```

### ๐ ุณุณุชู ฺูุฏุฒุจุงูู

#### ูพุดุชุจุงู ฺฉุงูู ุงุฒ ูุงุฑุณ ู ุงูฺฏูุณ:
- **ุชุฑุฌูู ฺฉุงูู**: ุชูุงู ุจุฎุดโูุง ุณุณุชู
- **ุชุบุฑ ุฒุจุงู ูพูุง**: ุจุฏูู ูุงุฒ ุจู ุจุงุฑฺฏุฐุงุฑ ูุฌุฏุฏ
- **ุฑุงุจุท ฺฉุงุฑุจุฑ ุจูู**: ุทุฑุงุญ ููุงุณุจ ุจุฑุง ูุฑ ุฒุจุงู

### ๐ ุณุณุชู ุงููุช

#### ูฺฺฏโูุง ุงููุช:
- **ุงุญุฑุงุฒ ููุช JWT**: ุชูฺฉูโูุง ุงูู
- **ฺฉูุชุฑู ุฏุณุชุฑุณ ุจุฑ ุงุณุงุณ ููุด (RBAC)**: ูุญุฏูุฏุช ุฏุณุชุฑุณ
- **ุซุจุช ฺฉุงูู ูุนุงูุชโูุง (Audit Log)**: ูพฺฏุฑ ุชูุงู ุนููุงุช
- **ูุญุฏูุฏุช ูุฑุฎ ุฏุฑุฎูุงุณุช**: ุฌููฺฏุฑ ุงุฒ ุญููุงุช

### ๐ ุณุณุชู ฺฏุฒุงุฑุดโุฏู ูพุดุฑูุชู

#### ฺฏุฒุงุฑุดุงุช ูุงู:
```sql
-- ฺฏุฒุงุฑุด ูุนุงููุงุช ุจุฑ ุงุณุงุณ ุงุฑุฒ
SELECT currency, SUM(amount) 
FROM transactions 
WHERE tenant_id = ? AND date BETWEEN ? AND ?
GROUP BY currency
```

#### ุฏุงุดุจูุฑุฏ ูุฏุฑุช:
- **ุขูุงุฑ ูุญุธูโุง**: ููุงุด ูุถุนุช ูุนู
- **ูููุฏุงุฑูุง ุชุนุงูู**: ุชุญูู ุฑููุฏูุง
- **ฺฏุฒุงุฑุดุงุช ุณูุงุฑุด**: ูุงุจูุช ุดุฎุตโุณุงุฒ

### ๐ฑ ูุฏุฑุช ูุฑุฎโฺฏุฐุงุฑ

#### ูุฏู ExchangeRate:
- **ูุฑุฎโูุง ุงุฎุชุตุงุต**: ุชุนู ูุฑุฎ ุชูุณุท ูุฑ ุตุฑุงู
- **ุชุงุฑุฎฺู ุชุบุฑุงุช**: ูพฺฏุฑ ุชุบุฑุงุช ูุฑุฎ
- **ููุงุณู ุจุง ุจุงุฒุงุฑ**: ููุงุณู ุจุง ูุฑุฎโูุง ุฌูุงู
- **ุจูโุฑูุฒุฑุณุงู ุฎูุฏฺฉุงุฑ**: ุงุฒ API ูุง ุฎุงุฑุฌ

## ๐ ฺฏุฑุฏุด ฺฉุงุฑ ุซุจุช ูุนุงููู

### ูุฑุขูุฏ ุฎุฑุฏ ุงุฑุฒ (ูุซุงู: ุฏุฑูู ุงูุงุฑุงุช):

1. **ุซุจุช ุฏุฑุฎูุงุณุช**:
   - ูุดุชุฑ ููุฏุงุฑ ู ููุน ุงุฑุฒ ููุฑุฏ ูุงุฒ ุฑุง ุงูุชุฎุงุจ ูโฺฉูุฏ
   - ุณุณุชู ูุฑุฎ ูุญุธูโุง ุฑุง ููุงุด ูโุฏูุฏ

2. **ุชุฃุฏ ูุนุงููู**:
   ```mermaid
   sequenceDiagram
       ูุดุชุฑ->>ุตุฑุงู: ุฏุฑุฎูุงุณุช ููุช
       ุตุฑุงู->>ุณุณุชู: ุซุจุช ูุฑุฎ ุชุจุฏู
       ุณุณุชู->>ูุดุชุฑ: ููุงุด ูุจูุบ ุฑุงู
       ูุดุชุฑ->>ุณุณุชู: ุชุฃุฏ ูุนุงููู
   ```

3. **ูพุฑุฏุงุฎุช**:
   - ูุดุชุฑ ุจู ฺฉ ุงุฒ ุฑูุดโูุง ุฒุฑ ูพุฑุฏุงุฎุช ูโฺฉูุฏ:
     - ูุงุฑุฒ ุจู ุญุณุงุจโูุง ูุดุฎุต ุดุฏู ุตุฑุงู (ฺูุฏุญุณุงุจู)
     - ูพุฑุฏุงุฎุช ุญุถูุฑ ุฏุฑ ุดุนุจู
   - ุจุฑุง ูุฑ ูพุฑุฏุงุฎุช:
     - ุขูพููุฏ ุฑุณุฏ ูพุฑุฏุงุฎุช
     - ุซุจุช ุฎูุฏฺฉุงุฑ ุชุงุฑุฎ ู ูุจูุบ
     - ุชุทุจู ุจุง ูุนุงููู ุซุจุช ุดุฏู

4. **ุชุณูู ุญุณุงุจ**:
   - ุณุณุชู ุจู ุตูุฑุช ุฎูุฏฺฉุงุฑ ูุจูุบ ุจุงูโูุงูุฏู ุฑุง ูุญุงุณุจู ูโฺฉูุฏ
   - ูุถุนุชโูุง ููฺฉู:
     - "ุฏุฑ ุงูุชุธุงุฑ ูพุฑุฏุงุฎุช" (ูพุฑุฏุงุฎุช ูุดุฏู)
     - "ูพุฑุฏุงุฎุช ุฌุฒุฆ" (ุจุฏู ุจุงู ูุงูุฏู)
     - "ุชฺฉูู ุดุฏู" (ูพุฑุฏุงุฎุช ฺฉุงูู)

5. **ุชุญูู ุงุฑุฒ**:
   - ูุดุชุฑ ุงูุชุฎุงุจ ูโฺฉูุฏ:
     - ุฏุฑุงูุช ูุฒฺฉ ุงุฒ ุดุนุจู (ุจุฏูู ฺฉุงุฑูุฒุฏ)
     - ุงูุชูุงู ุจู ุญุณุงุจ ุฎุงุฑุฌ (ุจุง ฺฉุงุฑูุฒุฏ)
     - ูฺฏูุฏุงุฑ ุฏุฑ ุญุณุงุจ ุตุฑุงู (ูุงููุฏ ุญุณุงุจ ุจุงูฺฉ)

## ๐ ุณุงุฎุชุงุฑ ูุงูโูุง ูพุงุฏูโุณุงุฒ ุดุฏู

### Backend Models:
- `Payment.js` - ูุฏุฑุช ูพุฑุฏุงุฎุชโูุง ฺูุฏุญุณุงุจู
- `Debt.js` - ูุฏุฑุช ุจุฏูโูุง ู ูุตูู
- `ExchangeAccount.js` - ุญุณุงุจโูุง ูฺฏูุฏุงุฑ ุงุฑุฒ
- `InterBranchTransfer.js` - ุงูุชูุงูุงุช ุจู ุดุนุจูโุง
- `Transaction.js` - ูุนุงููุงุช ุงุฑุฒ
- `ExchangeRate.js` - ูุฑุฎโูุง ุงุฑุฒ
- `User.js` - ฺฉุงุฑุจุฑุงู ู ููุดโูุง
- `Tenant.js` - ุตุฑุงูโูุง ู ุงุดุชุฑุงฺฉโูุง
- `Branch.js` - ุดุนุจูโูุง

### Backend Controllers:
- `payment.controller.js` - ฺฉูุชุฑู ูพุฑุฏุงุฎุชโูุง
- `debt.controller.js` - ฺฉูุชุฑู ุจุฏูโูุง
- `exchangeAccount.controller.js` - ฺฉูุชุฑู ุญุณุงุจโูุง
- `interBranchTransfer.controller.js` - ฺฉูุชุฑู ุงูุชูุงูุงุช
- `transaction.controller.js` - ฺฉูุชุฑู ูุนุงููุงุช
- `exchangeRate.controller.js` - ฺฉูุชุฑู ูุฑุฎโูุง
- `auth.controller.js` - ุงุญุฑุงุฒ ููุช
- `superAdmin.controller.js` - ูุฏุฑุช ุณููพุฑ ุงุฏูู

### Frontend Components:
- `PaymentManagement.jsx` - ูุฏุฑุช ูพุฑุฏุงุฎุชโูุง
- `DebtManagement.jsx` - ูุฏุฑุช ุจุฏูโูุง
- `CurrencyExchange.jsx` - ุชุจุฏู ุงุฑุฒ
- `RemittanceForm.jsx` - ูุฑู ุญูุงูู
- `Dashboard.jsx` - ุฏุงุดุจูุฑุฏ ูุฏุฑุช
- `SuperAdminDashboard.jsx` - ุฏุงุดุจูุฑุฏ ุณููพุฑ ุงุฏูู

### Routes:
- `/api/payments` - API ูพุฑุฏุงุฎุชโูุง
- `/api/debts` - API ุจุฏูโูุง
- `/api/accounts` - API ุญุณุงุจโูุง
- `/api/transfers` - API ุงูุชูุงูุงุช
- `/api/transactions` - API ูุนุงููุงุช
- `/api/rates` - API ูุฑุฎโูุง

## ๐ ูฺฺฏโูุง ููุญุตุฑ ุจู ูุฑุฏ

### 1. ุณุณุชู ูพุฑุฏุงุฎุช ฺูุฏุญุณุงุจู:
- ุงูฺฉุงู ุชูุณู ูพุฑุฏุงุฎุช ุจู ฺูุฏ ุญุณุงุจ ูุฎุชูู
- ุซุจุช ุฎูุฏฺฉุงุฑ ุฑุณุฏูุง ูพุฑุฏุงุฎุช
- ุชุทุจู ููุดููุฏ ูพุฑุฏุงุฎุชโูุง ุจุง ูุนุงููุงุช

### 2. ูุฏุฑุช ุจุฏูโูุง:
- ูพฺฏุฑ ูุถุนุช ุจุฏู ูุดุชุฑุงู
- ุงุฑุณุงู ุงุนูุงู ุฎูุฏฺฉุงุฑ ุจุฑุง ูพุฑุฏุงุฎุชโูุง ูุนูู
- ูุญุงุณุจู ุณูุฏ ุชุฃุฎุฑ (ุฏุฑ ุตูุฑุช ูุงุฒ)

### 3. ุญุณุงุจโูุง ูฺฏูุฏุงุฑ ุงุฑุฒ:
- ุนููฺฉุฑุฏ ูุดุงุจู ุญุณุงุจ ุจุงูฺฉ
- ุงูฺฉุงู ุจุฑุฏุงุดุช ุฌุฒุฆ ุง ฺฉู
- ุณูุฏุฏู ุจุฑ ุงุณุงุณ ูุฑุงุฑุฏุงุฏ

### 4. ูพุดุชุจุงู ุงุฒ ฺูุฏ ุดุนุจู:
- ูุฏุฑุช ูุชูุฑฺฉุฒ ุดุนุจูโูุง
- ฺฏุฒุงุฑุดโุฏู ูุณุชูู ูุฑ ุดุนุจู
- ุงูุชูุงู ูุฌู ุจู ุดุนุจูโุง

## ๐ ูุซุงู ฺฏุฑุฏุด ฺฉุงุฑ ฺฉุงูู

| ูุฑุญูู | ูุฑุขูุฏ ุณุณุชู | ูุถุนุช ุญุณุงุจ ูุดุชุฑ |
|-------|--------------|-------------------|
| 1 | ุซุจุช ุฏุฑุฎูุงุณุช ุฎุฑุฏ 1000 ุฏุฑูู (ูุฑุฎ 10,000 ุชููุงู) | ุจุฏูฺฉุงุฑ: 10,000,000 ุชููุงู |
| 2 | ูพุฑุฏุงุฎุช ุงููู: 5,000,000 ุชููุงู | ุจุฏูฺฉุงุฑ: 5,000,000 ุชููุงู |
| 3 | ูพุฑุฏุงุฎุช ููุง: 5,000,000 ุชููุงู | ููุฌูุฏ: +1000 ุฏุฑูู |
| 4 | ุฏุฑุฎูุงุณุช ุจุฑุฏุงุดุช 500 ุฏุฑูู | ููุฌูุฏ: 500 ุฏุฑูู |

## ๐ฎ ุชูุณุนูโูุง ุขูุฏู

### 1. ฺฉูพุงุฑฺูโุณุงุฒ ุจุง ุจุงูฺฉโูุง:
- ุงุฑุชุจุงุท ูุณุชูู ุจุง ุณุงูุงููโูุง ุจุงูฺฉ
- ุชุณูู ุฎูุฏฺฉุงุฑ ุญุณุงุจโูุง

### 2. ุงุฑุฒูุง ุฏุฌุชุงู:
- ุฎุฑุฏ ู ูุฑูุด ุงุฑุฒูุง ุฏุฌุชุงู
- ฺฉู ูพูู ุงูู ุฑูุฒุงุฑุฒูุง

### 3. ููุจุงู ุงูพูฺฉุดู:
- ูุณุฎู ููุจุงู ุจุฑุง ูุดุชุฑุงู
- ุงุญุฑุงุฒ ููุช ุจููุชุฑฺฉ

### 4. ููุด ูุตููุน:
- ูพุดโุจู ูุฑุฎ ุงุฑุฒ
- ุชุดุฎุต ุงูฺฏููุง ูุนุงููุงุช ูุดฺฉูฺฉ

## โ ูุชุฌูโฺฏุฑ

ุงู ุณุณุชู ุจู ฺฏูููโุง ุทุฑุงุญ ุดุฏู ฺฉู ุชูุงู ูุงุฒูุง ฺฉ ุดุจฺฉู ุจุฒุฑฺฏ ุตุฑุงูโูุง ูุณุชูู ุงูุง ูุชุตู ุจู ูู ุฑุง ุจุฑุขูุฑุฏู ูโฺฉูุฏุ ุจุง ุญูุธ ฺฉุงูู ุญุฑู ุฎุตูุต ุฏุงุฏูโูุง ูุฑ ุตุฑุงู ู ูุดุชุฑุงูุด.

### ูฺฺฏโูุง ฺฉูุฏ ูพุงุฏูโุณุงุฒ ุดุฏู:
- โ ุณุณุชู ฺูุฏ ุณุทุญ (Multi-Tenant Hierarchy)
- โ ุณุณุชู ูพุฑุฏุงุฎุช ฺูุฏุญุณุงุจู
- โ ูุฏุฑุช ุจุฏูโูุง
- โ ุญุณุงุจโูุง ูฺฏูุฏุงุฑ ุงุฑุฒ
- โ ุงูุชูุงูุงุช ุจู ุดุนุจูโุง
- โ ุณุณุชู ฺูุฏุฒุจุงูู (ูุงุฑุณ/ุงูฺฏูุณ)
- โ ุณุณุชู ุงููุช ูพุดุฑูุชู
- โ ฺฏุฒุงุฑุดโุฏู ุฌุงูุน
- โ ูุฏุฑุช ูุฑุฎโฺฏุฐุงุฑ
- โ ฺฏุฑุฏุด ฺฉุงุฑ ฺฉุงูู ูุนุงููุงุช

ุณุณุชู ุขูุงุฏู ุงุณุชูุงุฏู ู ูุงุจู ุชูุณุนู ุจุฑุง ูุงุฒูุง ุขูุฏู ุงุณุช. 